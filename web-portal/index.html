<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Hiverra Industries" />
    <meta
      name="description"
      content="Portal is a secure and simple way to upload files and images directly over HTTPS, preserving quality and making sharing fast and easy."
    />
    <title>Portal â€” upload</title>
    <link rel="stylesheet" href="static/style.css" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="static/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="static/favicon-16x16.png"
    />
    <link rel="icon" type="image/x-icon" href="static/favicon.ico" />
  </head>

  <body>
    <div class="container">
      <h2>Choose the Files and upload</h2>

      <form method="POST" enctype="multipart/form-data" id="uploadForm">
        <input type="file" name="files" multiple />
        <button type="submit" id="uploadBtn">Upload</button>
      </form>

      <p class="message" id="statusMessage" style="display: none"></p>
    </div>
    <footer>
      &copy; 2026 Hiverra. All rights reserved.
      <a href="https://github.com/spectra010s" target="_blank">spectra010s</a>
    </footer>
    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

      const SUPABASE_URL = "your supabase url";
      const SUPABASE_ANON_KEY = "your api anon key";
      const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      const form = document.getElementById("uploadForm");
      const uploadBtn = document.getElementById("uploadBtn");
      const statusMsg = document.getElementById("statusMessage");
      const bucketName = "portal";

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const files = form.files.files;
        if (!files.length) return alert("Select at least one file.");

        uploadBtn.style.display = "none";

        statusMsg.style.display = "block";
        statusMsg.textContent =
          files.length === 1 ? "Uploading file..." : "Uploading files...";

        try {
          for (const file of files) {
            const filePath = `${Date.now()}_${file.name}`;
            const { data, error } = await supabase.storage
              .from(bucketName)
              .upload(filePath, file);

            if (error) throw error;
            console.log("Uploaded:", data.path);
          }
          statusMsg.textContent =
            files.length === 1
              ? "File uploaded successfully!"
              : "All files uploaded successfully!";
        } catch (err) {
          console.error("Upload error:", err);
          statusMsg.textContent = `Upload failed: ${err.message}`;
        } finally {
          setTimeout(() => {
            statusMsg.classList.add("fade-out");
            setTimeout(() => {
              statusMsg.style.display = "none";
              statusMsg.classList.remove("fade-out");
              uploadBtn.style.display = "inline-block";
            }, 500);
          }, 2000);
          form.reset();
        }
      });
    </script>
  </body>
</html>
